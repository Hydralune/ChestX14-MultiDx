# 胸部X光多标签分类配置文件 - Swin Transformer

# 数据路径（相对于仓库根目录）
data:
  csv_path: "/root/ChestX14-MultiDx/filtered_labels.csv"
  image_dir: "/root/ChestX14-MultiDx/images"
  train_ratio: 0.7
  val_ratio: 0.15
  test_ratio: 0.15

# 模型配置
model:
  name: "Swin-T"
  num_classes: 14
  pretrained: true
  # 模型大小: "tiny" (28M), "small" (50M), "base" (88M)
  # 更大的模型通常有更好的性能，但需要更多显存和训练时间
  model_size: "tiny"  # 推荐: "small" 或 "base" 以获得更高精度
  # 输入通道处理方式: "expand" (灰度图扩展到3通道) 或 "modify" (修改第一层适配1通道)
  input_channel_mode: "expand"

# 训练配置
train:
  # 如果使用更大的模型或图像尺寸，可能需要减小batch_size
  batch_size: 12  # 640分辨率建议使用12，如果显存不足可减小到8
  num_epochs: 150  # 增加训练轮数以获得更好的收敛
  learning_rate: 0.0001
  weight_decay: 0.0001
  scheduler: "cosine"  # "cosine" 或 "linear"
  warmup_epochs: 5
  eta_min: 1e-6  # Cosine annealing的最小学习率
  
  # 损失函数配置
  loss_type: "asymmetric_loss"  # "weighted_bce", "focal_loss", "asymmetric_loss", "combined"
  focal_alpha: 0.25
  focal_gamma: 2.0
  # Asymmetric Loss参数（推荐用于多标签分类）
  asymmetric_gamma_neg: 4  # 负样本gamma，通常较大
  asymmetric_gamma_pos: 1  # 正样本gamma，通常较小
  asymmetric_clip: 0.05    # 概率裁剪阈值
  # Combined Loss参数
  combined_alpha: 0.5      # Weighted BCE和Asymmetric Loss的权重
  
  # EMA配置（指数移动平均，提升模型性能）
  use_ema: true
  ema_decay: 0.9999
  
  # 梯度累积（模拟更大的batch size）
  gradient_accumulation_steps: 1
  
  # Mixup数据增强（医学图像通常不适合Mixup，会破坏解剖结构）
  use_mixup: false  # 医学图像建议关闭，之前关闭后性能有提升
  mixup_alpha: 0.2  # Beta分布参数，越小混合越平滑
  
  mixed_precision: true
  
  resume: false
  resume_checkpoint: ""

# 输入图像配置
image:
  # 图像尺寸：更大的尺寸通常有更好的性能，但需要更多显存
  # 推荐: 512 (当前), 640, 768, 896
  # 注意：Swin Transformer支持任意尺寸（需为32的倍数）
  size: 640  # 提升到640以获得更高精度（如果显存充足，可尝试768或896）
  mean: [0.485, 0.456, 0.406]
  std: [0.229, 0.224, 0.225]

# 保存路径（相对于Swin-T目录）
paths:
  checkpoint_dir: "checkpoints"
  log_dir: "logs"
  result_dir: "results"

# 设备
device: "cuda"

# 随机种子
seed: 2024

